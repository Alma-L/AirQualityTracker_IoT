<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Air Quality Tracker IoT v2.0 - Advanced Monitoring</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="icon" type="image/png" href="/static/favicon.png" />
</head>
<body>

  <nav class="sidebar">
    <h1>Air Quality Tracker</h1>
    <a href="#stats">📊 Statistics</a>
    <a href="#latest">📡 Latest Readings</a>
    <a href="#analytics">📈 Analytics</a>
    <a href="#recent">📋 Recent Readings</a>
    <a href="#alerts">🚨 Alerts</a>
    <a href="#health">🏥 System Health</a>
  </nav>

  <div class="container">

    <!-- Connection Status Indicator -->
    <div id="connectionBanner" class="connection-status status-warning">Checking connection...</div>

    <!-- System Statistics -->
    <section class="card stats-card" id="stats">
      <h2>📊 System Statistics</h2>
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-label">Active Sensors:</span>
          <span id="activeSensors" class="stat-value">Loading...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Total Readings:</span>
          <span id="totalReadings" class="stat-value">Loading...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Active Alerts:</span>
          <span id="activeAlerts" class="stat-value">Loading...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Uptime:</span>
          <span id="uptime" class="stat-value">Loading...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Average AQI:</span>
          <span id="averageAQI" class="stat-value">Loading...</span>
        </div>
      </div>

      <div class="sensor-list">
        <h3>📡 Active Sensors</h3>
        <div id="sensorList">
          <p class="loading">Loading sensor information...</p>
        </div>
      </div>
    </section>

    <!-- Latest Readings -->
    <section class="card" id="latest">
      <h2>📡 Latest Readings (All Sensors) - Enhanced with AQI</h2>
      <button id="refresh">🔄 Refresh</button>
      <button id="exportCSV">📥 Export CSV</button>
      <div class="grid" id="latestGrid"></div>
      
    </section>

    <!-- Analytics Dashboard -->
    <section class="card analytics-card" id="analytics">
      <h2>📈 Advanced Analytics Dashboard</h2>
      <div class="analytics-controls">
        <label for="analytics-sensor">Sensor ID:</label>
        <input id="analytics-sensor" type="text" value="sensor-virtual-1" />
        <label for="analytics-hours">Time Period (hours):</label>
        <select id="analytics-hours">
          <option value="1">1 hour</option>
          <option value="6">6 hours</option>
          <option value="24" selected>24 hours</option>
          <option value="48">48 hours</option>
          <option value="168">1 week</option>
        </select>
        <button id="load-analytics">📊 Load Analytics</button>
      </div>
      <div id="analyticsContent" class="analytics-content">
        <p>Select a sensor and time period to view detailed analytics</p>
      </div>
    </section>

    <!-- Recent Readings -->
    <section class="card recent-card" id="recent">
      <h2>📋 Recent Readings (One Sensor) - Enhanced with AQI</h2>
      <form id="sensor-form" class="sensor-form">
        <input id="sensor-id" placeholder="sensor-virtual-1" />
        <input id="limit" type="number" min="1" max="500" value="20" />
        <button type="submit">📊 Load</button>
      </form>
      <table id="recent-table">
        <thead>
          <tr>
            <th>PM2.5</th>
            <th>PM10</th>
            <th>AQI</th>
            <th>Temp (°C)</th>
            <th>Humidity (%)</th>
            <th>Timestamp</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Alerts -->
    <section class="card alerts-card" id="alerts">
      <h2>🚨 Real-time Alerts & Notifications</h2>
      <div id="alertsContainer" class="alerts-container">
        <p class="no-alerts">No active alerts</p>
      </div>
    </section>

    <!-- System Health -->
    <section class="card health-card" id="health">
      <h2>🏥 System Health & Performance</h2>
      <div class="health-grid">
        <div class="health-item">
          <span class="health-label">Backend Status:</span>
          <span id="backendStatus" class="health-value">Checking...</span>
        </div>
        <div class="health-item">
          <span class="health-label">Database:</span>
          <span class="health-value">In-Memory (Active)</span>
        </div>
        <div class="health-item">
          <span class="health-label">WebSocket:</span>
          <span id="wsStatus" class="health-value">Connecting...</span>
        </div>
        <div class="health-item">
          <span class="health-label">Last Update:</span>
          <span id="lastUpdate" class="health-value">Never</span>
        </div>
      </div>
    </section>

  </div>

  <footer>
    <small>Backend: http://localhost:8000 | Version 2.0 | Real-time updates via WebSocket | AQI & Analytics</small>
  </footer>

  <script src="/static/app.js"></script>
</body>
</html>
