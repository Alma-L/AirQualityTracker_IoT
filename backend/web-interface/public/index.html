<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Air Quality Tracker IoT v2.0 - Advanced Monitoring</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <!-- Connection Status Indicator -->
  <div id="connectionStatus" class="connection-status status-warning">Checking...</div>
  
  <div class="container">
  <header>
    <h1>🌍 Air Quality Tracker IoT v2.0 - Advanced Monitoring</h1>
    <div class="header-status">
      <div class="connection-status">
        <span>Status: </span>
        <span id="connectionStatus">Connecting...</span>
      </div>
      <div class="air-quality-status">
        <span id="overallAirQuality">Loading...</span>
      </div>
    </div>
  </header>

  <main>
    <!-- Enhanced System Statistics -->
    <section class="card stats-card">
      <h2>📊 System Statistics</h2>
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-label">Active Sensors:</span>
          <span id="activeSensors" class="stat-value">Loading...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Total Readings:</span>
          <span id="totalReadings" class="stat-value">Loading...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Active Alerts:</span>
          <span id="activeAlerts" class="stat-value">Loading...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Uptime:</span>
          <span id="uptime" class="stat-value">Loading...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Average AQI:</span>
          <span id="averageAQI" class="stat-value">Loading...</span>
        </div>
      </div>
      
      <!-- Sensor List Section -->
      <div class="sensor-list">
        <h3>📡 Active Sensors</h3>
        <div id="sensorList">
          <p class="loading">Loading sensor information...</p>
        </div>
      </div>
    </section>

    <!-- Latest Readings with AQI -->
    <section class="card">
      <h2>📡 Latest Readings (All Sensors) - Enhanced with AQI</h2>
      <button id="refresh">🔄 Refresh</button>
      <div id="latest" class="grid"></div>
    </section>

    <!-- Analytics Dashboard -->
    <section class="card analytics-card">
      <h2>📈 Advanced Analytics Dashboard</h2>
      <div class="analytics-controls">
        <label for="analytics-sensor">Sensor ID:</label>
        <input id="analytics-sensor" type="text" value="sensor-virtual-1" />
        <label for="analytics-hours">Time Period (hours):</label>
        <select id="analytics-hours">
          <option value="1">1 hour</option>
          <option value="6">6 hours</option>
          <option value="24" selected>24 hours</option>
          <option value="48">48 hours</option>
          <option value="168">1 week</option>
        </select>
        <button id="load-analytics">📊 Load Analytics</button>
      </div>
      <div id="analytics" class="analytics-content">
        <p>Select a sensor and time period to view detailed analytics</p>
      </div>
    </section>

    <!-- Recent Readings with AQI -->
    <section class="card">
      <h2>📋 Recent Readings (One Sensor) - Enhanced with AQI</h2>
      <form id="sensor-form">
        <input id="sensor-id" placeholder="sensor-virtual-1" />
        <input id="limit" type="number" min="1" max="500" value="20" />
        <button type="submit">📊 Load</button>
      </form>
      <table id="recent-table">
        <thead>
          <tr>
            <th>PM2.5</th>
            <th>PM10</th>
            <th>AQI</th>
            <th>Temp (°C)</th>
            <th>Humidity (%)</th>
            <th>Timestamp</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Real-time Alerts -->
    <section class="card alerts-card">
      <h2>🚨 Real-time Alerts & Notifications</h2>
      <div id="alerts" class="alerts-container">
        <p class="no-alerts">No active alerts</p>
      </div>
    </section>

    <!-- System Health -->
    <section class="card health-card">
      <h2>🏥 System Health & Performance</h2>
      <div class="health-grid">
        <div class="health-item">
          <span class="health-label">Backend Status:</span>
          <span id="backendStatus" class="health-value">Checking...</span>
        </div>
        <div class="health-item">
          <span class="health-label">Database:</span>
          <span class="health-value">In-Memory (Active)</span>
        </div>
        <div class="health-item">
          <span class="health-label">WebSocket:</span>
          <span id="wsStatus" class="health-value">Connecting...</span>
        </div>
        <div class="health-item">
          <span class="health-label">Last Update:</span>
          <span id="lastUpdate" class="health-value">Never</span>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <small>Backend: http://localhost:8000 | Version 2.0 | Real-time updates via WebSocket | AQI & Analytics</small>
  </footer>

<link rel="stylesheet" href="/static/style.css" />
<script src="/static/app.js"></script>
</body>
</html>
