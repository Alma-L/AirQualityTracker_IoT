<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Air Quality Tracker IoT v2.0 - Advanced Monitoring</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/static/style.css" />
    <link rel="icon" type="image/png" href="/static/favicon.png" />
  </head>
  <body>
    <nav class="sidebar">
      <h1>Air Quality Tracker</h1>
      <a href="#stats">📊 Statistics</a>
      <a href="#latest">📡 Latest Readings</a>
      <a href="#analytics">📈 Analytics</a>
      <a href="#recent">📋 Recent Readings</a>
      <a href="#alerts">🚨 Alerts</a>
      <a href="#ml-analysis">🤖 ML Analysis</a>
      <a href="#health">🏥 System Health</a>
      <a href="#sensors">🛰️ Sensors</a>
      <a href="#smart-sensors">🌬️ Smart Virtual Sensors</a>
    </nav>

    <div class="container">
      <!-- System Statistics -->
      <section class="card stats-card" id="stats">
        <h2>📊 System Statistics</h2>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-label">Active Sensors:</span>
            <span id="activeSensors" class="stat-value">Loading...</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total Readings:</span>
            <span id="totalReadings" class="stat-value">Loading...</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Active Alerts:</span>
            <span id="activeAlerts" class="stat-value">Loading...</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Uptime:</span>
            <span id="uptime" class="stat-value">Loading...</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Average AQI:</span>
            <span id="averageAQI" class="stat-value">Loading...</span>
          </div>
        </div>

        <div class="sensor-list">
          <h3>📡 Active Sensors</h3>
          <div id="sensorList">
            <p class="loading">Loading sensor information...</p>
          </div>
        </div>
      </section>

      <!-- Latest Readings -->
      <section class="card" id="latest">
        <h2>📡 Latest Readings (All Sensors) - Enhanced with AQI</h2>
        <button id="refresh">🔄 Refresh</button>
        <button id="exportCSV">📥 Export CSV</button>
        <div class="grid" id="latestGrid"></div>
      </section>

      <!-- Analytics Dashboard -->
      <section class="card analytics-card" id="analytics">
        <h2>📈 Advanced Analytics Dashboard</h2>
        <div class="analytics-controls">
          <label for="analytics-sensor">Sensor ID:</label>
          <select
            id="analytics-sensor"
            style="border: 1px solid rgb(89, 86, 86)"
          >
            <option value="sensor-urban-1">Urban Sensor</option>
            <option value="sensor-industrial-1">Industrial Sensor</option>
            <option value="sensor-residential-1">Residential Sensor</option>
            <option value="sensor-bus-1">Mobile Sensor</option>
            <option value="sensor-wearable-1">Wearable Sensor</option>
            <option value="sensor-drone-1">Drone Sensor</option>
          </select>

          <label for="analytics-hours">Time Period (hours):</label>
          <select id="analytics-hours">
            <option value="1">1 hour</option>
            <option value="6">6 hours</option>
            <option value="24" selected>24 hours</option>
            <option value="48">48 hours</option>
            <option value="168">1 week</option>
          </select>
          <button id="load-analytics">📊 Load Analytics</button>
        </div>
        <div id="analyticsContent" class="analytics-content">
          <p>Select a sensor and time period to view detailed analytics</p>
        </div>
      </section>

      <!-- Recent Readings -->
      <section class="card recent-card" id="recent">
        <h2>📋 Recent Readings (One Sensor) - Enhanced with AQI</h2>
        <form
          id="sensor-form"
          class="sensor-form"
          style="border: 1px solid black"
        >
          <label for="sensor-id">Choose Sensor:</label>
          <select id="sensor-id" style="border: 1px solid rgb(89, 86, 86)">
            <option value="sensor-urban-1">Urban Sensor</option>
            <option value="sensor-industrial-1">Industrial Sensor</option>
            <option value="sensor-residential-1">Residential Sensor</option>
            <option value="sensor-bus-1">Mobile Sensor</option>
            <option value="sensor-wearable-1">Wearable Sensor</option>
            <option value="sensor-drone-1">Drone Sensor</option>
          </select>
          <label>Choose number of readings:</label>
          <input
            id="limit"
            type="number"
            min="1"
            max="500"
            value="20"
            style="border: 1px solid rgb(89, 86, 86)"
          />
          <button type="submit">📊 Load</button>
        </form>

        <table id="recent-table">
          <thead>
            <tr>
              <th>PM2.5</th>
              <th>PM10</th>
              <th>AQI</th>
              <th>Temp (°C)</th>
              <th>Humidity (%)</th>
              <th>Timestamp</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <!-- Alerts -->
      <section class="card alerts-card" id="alerts">
        <h2>🚨 Real-time Alerts & Notifications</h2>
        <div id="alertsContainer" class="alerts-container">
          <p class="no-alerts">No active alerts</p>
        </div>
      </section>

      <!-- Machine Learning Analysis -->
      <section class="card ml-card" id="ml-analysis">
        <h2>🤖 Machine Learning Algorithm Analysis</h2>
        <div class="ml-controls">
          <label for="ml-sensor">Sensor ID:</label>
          <select id="ml-sensor">
            <option value="sensor-urban-1">Urban Sensor</option>
            <option value="sensor-industrial-1">Industrial Sensor</option>
            <option value="sensor-residential-1">Residential Sensor</option>
            <option value="sensor-bus-1">Mobile Sensor</option>
            <option value="sensor-wearable-1">Wearable Sensor</option>
            <option value="sensor-drone-1">Drone Sensor</option>
          </select>

          <label for="ml-algorithm">Algorithm:</label>
          <select id="ml-algorithm">
            <option value="random-forest">Random Forest</option>
            <option value="svm">SVM (One-Class)</option>
            <option value="kmeans">K-Means</option>
          </select>

          <label for="ml-hours">Time Period (hours):</label>
          <select id="ml-hours">
            <option value="1">1 hour</option>
            <option value="6">6 hours</option>
            <option value="24" selected>24 hours</option>
            <option value="48">48 hours</option>
            <option value="168">1 week</option>
          </select>

          <button id="run-ml">🚀 Run Analysis</button>
        </div>

        <div id="mlResults" class="ml-results">
          <p>Run the analysis to see detected anomalies or predictions.</p>
        </div>

        <!-- Add the canvas for Chart.js -->
        <canvas
          id="mlChart"
          width="600"
          height="400"
          style="margin-top: 20px"
        ></canvas>
      </section>

      <!-- System Health -->
      <section class="card health-card" id="health">
        <h2>🏥 System Health & Performance</h2>
        <div class="health-grid">
          <div class="health-item">
            <span class="health-label">Backend Status:</span>
            <span id="backendStatus" class="health-value">Checking...</span>
          </div>
          <div class="health-item">
            <span class="health-label">Database:</span>
            <span class="health-value">In-Memory (Active)</span>
          </div>
          <div class="health-item">
            <span class="health-label">WebSocket:</span>
            <span id="wsStatus" class="health-value">Connecting...</span>
          </div>
          <div class="health-item">
            <span class="health-label">Last Update:</span>
            <span id="lastUpdate" class="health-value">Never</span>
          </div>
        </div>
      </section>

      <!-- Sensors Overview -->
      <section class="card" id="sensors">
        <h2>🛰️ Sensors Overview</h2>
        <div class="sensors-grid" id="sensorsGrid">
          <p class="loading">Loading sensors...</p>
        </div>
      </section>

      <!-- Smart Virtual Sensors Dashboard -->
      <section class="card smart-sensors-card" id="smart-sensors">
        <h2>🌬️ Smart Virtual Air Quality Sensors</h2>
        <p class="section-description">Real-time air quality monitoring across major cities in Kosovo with database integration</p>
        
        <!-- Smart Statistics -->
        <div class="smart-stats-grid" id="smartStatsGrid">
          <!-- Statistics will be populated here -->
        </div>
        
        <!-- Kosovo Map -->
        <div class="kosovo-map-container">
          <h3>🗺️ Kosovo Air Quality Map</h3>
          <p class="map-description">Real-time air quality monitoring across major cities in Kosovo</p>
          
          <div class="kosovo-map" id="kosovoMap">
            <img src="/static/images/kosovo-map.png" 
                 alt="Kosovo Map" 
                 class="map-image" />
            <div id="mapMarkers"></div>
          </div>
          
          <!-- Map Statistics -->
          <div class="map-stats">
            <div class="map-stat-item">
              <span class="stat-number" id="totalSensorsOnMap">8</span>
              <span class="stat-label">Total Sensors</span>
            </div>
            <div class="map-stat-item">
              <span class="stat-number" id="avgAQIOnMap">52</span>
              <span class="stat-label">Avg AQI</span>
            </div>
            <div class="map-stat-item">
              <span class="stat-number" id="citiesCovered">8</span>
              <span class="stat-label">Cities</span>
            </div>
          </div>
        </div>
        
        <!-- Smart Controls -->
        <div class="smart-controls">
          <button id="smart-refresh" class="btn-primary">🔄 Refresh Data</button>
          <button id="smart-export" class="btn-secondary">📊 Export CSV</button>
          <button id="smart-auto-refresh" class="btn-success">⏰ Auto Refresh</button>
        </div>
        
        
        <!-- Sensors Grid -->
        <div class="smart-sensors-grid" id="smartSensorsGrid">
          <!-- Smart sensor cards will be populated here -->
        </div>
        
        <div class="smart-status">
          <span class="status-indicator" id="smartStatusIndicator"></span>
          <span id="smartLastUpdate">Last updated: Never</span>
          <span id="smartAutoRefreshStatus" class="auto-refresh-status">Auto refresh: OFF</span>
        </div>
      </section>
    </div>

    <footer>
      <small
        >Backend: http://localhost:8000 | Version 2.0 | Real-time updates via
        WebSocket | AQI & Analytics</small
      >
    </footer>

    <script src="/static/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </body>
</html>
